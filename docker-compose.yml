version: '3.8'
name: twins-dev
services:
  twinfaces:
    image: $HARBOR_HOST/$HARBOR_PROJECT/$IMAGE_NAME_TWINFACES:${IMAGE_TAG}
    ports:
      - "10322:80"
    environment:
      NEXT_PUBLIC_TWINS_API_URL: "http://localhost:10321"
    restart: always

  twins:
    image: $HARBOR_HOST/$HARBOR_PROJECT/$IMAGE_NAME_TWINS:${IMAGE_TAG}
    container_name: twins-core
    environment:
      - JAVA_OPTS="-Djdk.internal.httpclient.debug=${JAVA_DEBUG}"
      - JAVA_TOOL_OPTIONS="-Xrunjdwp:transport=dt_socket,address=*:10321,server=y,suspend=n"
      - server.servlet.context-path=/api
      - spring.datasource.url=jdbc:postgresql://database/twins
      - spring.datasource.username=twins_user
      - spring.datasource.password=twins_pass
      - spring.datasource.driverClassName=org.postgresql.Driver
      - spring.flyway.enabled=true
      - spring.flyway.placeholder-replacement=false
    volumes:
      - ./logs:/opt/twins/logs
    ports:
      - "10321:10321"
    restart: always

  database:
    image: postgres:16.3
    ports:
      - "10320:5432"
    restart: always
    volumes:
      - twins-db:/var/lib/postgresql/data
    environment:
      - POSTGRES_USER=twins_user
      - POSTGRES_PASSWORD=twins_pass
      - POSTGRES_DB=twins
volumes:
  twins-db:
